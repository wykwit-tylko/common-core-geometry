# Common Core Geometry - WebAssembly Bindings

WebAssembly bindings for the Common Core Geometry library. This package provides a high-performance 3D geometry engine for use in web browsers and Node.js environments.

## Installation

```bash
npm install @common-core/geometry
```

## Quick Start

### Bundler (Webpack, Vite, Rollup)

```javascript
import * as geometry from '@common-core/geometry';

const p1 = new geometry.Point3D(0, 0, 0);
const p2 = new geometry.Point3D(3, 4, 0);
const distance = p1.distanceTo(p2); // 5.0
```

### Vanilla HTML/ES Modules

```html
<script type="module">
  import init, * as geometry from './pkg/index.js';
  
  await init();
  
  const point = new geometry.Point3D(1, 2, 3);
  console.log(`Point: (${point.x}, ${point.y}, ${point.z})`);
</script>
```

### Node.js

```javascript
const geometry = require('@common-core/geometry');

const sphere = new geometry.Sphere(
  new geometry.Point3D(0, 0, 0),
  5.0
);
console.log('Volume:', sphere.volume());
```

## Features

- **8 Geometric Primitives**: Point3D, Vector3D, Sphere, Ray, Triangle, Plane, AABB, LineSegment
- **Intersection Operations**: Ray-sphere, ray-plane, ray-triangle, AABB-AABB
- **SVG Rendering**: Perspective and orthographic camera support
- **TypeScript Support**: Full type definitions included
- **Multiple Targets**: Bundler, web, and Node.js environments
- **High Performance**: Compiled from Rust to WebAssembly
- **Small Size**: 44KB gzipped (111KB uncompressed)

## API Overview

### Primitives

```javascript
// Point3D
const point = new geometry.Point3D(1, 2, 3);
const translated = point.translate(vector);
const midpoint = point.midpoint(other);

// Vector3D
const vector = new geometry.Vector3D(1, 0, 0);
const normalized = vector.normalize();
const cross = vector.cross(other);

// Sphere
const sphere = new geometry.Sphere(center, 5.0);
console.log(sphere.volume(), sphere.surfaceArea());

// Ray
const ray = new geometry.Ray(origin, direction);
const intersection = ray.intersectSphere(sphere);
```

### SVG Rendering

```javascript
const camera = new geometry.PerspectiveCamera(
  position,
  target,
  up,
  Math.PI / 4,
  16 / 9
);

const renderer = new geometry.SVGRenderer(camera);
renderer.addSphere(sphere, { fill: 'blue', stroke: 'black' });
const svg = renderer.render();
```

## Examples

See the `examples/` directory for complete interactive HTML examples:
- **basic.html**: Basic geometry operations with primitives
- **ray_casting.html**: Ray intersection demonstrations
- **svg_rendering.html**: Interactive 3D SVG scene rendering with camera controls
- **index.html**: Landing page with links to all examples

### Running Examples

To view the examples locally, serve the WASM crate directory with a static file server:

```bash
cd crates/wasm
npx serve .
# Open http://localhost:3000/examples/
```

## Browser Compatibility

This library requires WebAssembly support and works in all modern browsers:
- Chrome 57+
- Firefox 52+
- Safari 11+
- Edge 16+

## Bundle Size

- **Uncompressed**: 111KB
- **Gzipped**: 44KB

All 8 primitives and operations included.

## Development

### Building from Source

The WASM bindings are built using `wasm-pack`, which compiles the Rust code to WebAssembly and generates JavaScript bindings for different target environments.

**Prerequisites:**
```bash
cargo install wasm-pack
```

**Build Commands:**

```bash
# Build for bundlers (webpack, vite, rollup, etc.)
# Output: pkg/
npm run build

# Build for browser ES modules (vanilla HTML)
# Output: pkg-web/
npm run build:web

# Build for Node.js CommonJS
# Output: pkg-nodejs/
npm run build:nodejs
```

**Build Artifacts:**

Each build target creates a separate output directory:
- `pkg/` - Bundler target (default)
- `pkg-web/` - Web/ES modules target
- `pkg-nodejs/` - Node.js target

These directories contain:
- Compiled `.wasm` binary (~111KB)
- JavaScript glue code
- TypeScript definitions (`.d.ts`)
- `package.json` for distribution

**Note:** The `pkg-*/` directories are build artifacts and should not be committed to git. They are regenerated by the build commands.

### Running Tests

Tests are written using Bun's testing framework and run against the Node.js target build.

**Prerequisites:**
```bash
# Install Bun (if not already installed)
curl -fsSL https://bun.sh/install | bash
```

**Test Commands:**

```bash
# Build the Node.js target and run tests
npm test

# Or run tests directly with Bun
bun run build:nodejs
bun test
```

The test suite includes:
- **primitives.test.js**: Tests for Point3D, Vector3D, Sphere, Ray, Triangle, Plane, AABB, LineSegment
- **svg.test.js**: Tests for Camera and SVGRenderer functionality

**Note:** Tests use the `pkg-nodejs/` build output, which is automatically generated when running `npm test`.


## License

MIT OR Apache-2.0
